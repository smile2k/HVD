
## 4.1 Introduce
**Delegate** (_hàm ủy quyền_) là một kiểu dữ liệu, nó dùng để tham chiếu (trỏ đến) đến các hàm (phương thức) có tham số và kiểu trả về phù hợp với khai báo kiểu. Khi dùng đến `delegate` bạn có thể gán vào nó một, nhiều hàm (phương thức) có sự tương thích về tham số, kiểu trả về, sau đó dùng nó để gọi hàm _(giống con trỏ trong C++)_, các `event` trong C# chính là các hàm được gọi thông qua `delegate`, bạn cũng có thể dùng delegate để xây dựng các hàm callback, đặc biệt là các [Event](https://xuanthulab.net/event-trong-c-cac-event-cua-net.html)
`Delegate` được dùng phổ biến khi gán các biểu thức `lambda`

## 4.2 Gán nhiều phương thức vào Delegate
Một delegate có thể đưa vào nó nhiều phương thức để một lần gọi thi hành tất cả các phương thức nó chứa
- **Toán tử `+=`** Nối thêm một phương thức vào delegate, ví dụ `delegatevar += method1`
- **Toán tử `-=`** : Loại bỏ 1 phương ở cuối (nếu phương thức đó có trong delegate, tính từ cuối) , ví dụ `delegatevar -= method1`
```CSharp
public static void TestShowLogMulti()
{
    ShowLog showLog;

    showLog = null;
    showLog += Warning;         // Nối thêm Warning vào delegate
    showLog += Info;            // Nối thêm Info vào delegate
    showLog += Warning;         // Nối thêm Warning vào delegate

    //Một lần gọi thi hành tất cả các phương thức trong chuỗi delegate
    showLog("TestLog");         //Hoặc an toàn: showLog?.Invoke("TestLog");
}
```

Ngoài cách gán cho delegate một hàm có tên cụ thể như trên, bạn cũng có thể gán một phương thức Anonymous, ví dụ:
```Csharp
showLog += (x) => Console.WriteLine(string.Format("===>{0}<===", x));
```

Các delegate cùng kiểu có thể kết hợp lại với nhau bằng toán tử `+`, ví dụ:
```CSharp
// Cộng nhiều Delegate
public static void TestShowLogPlus()
{
    ShowLog showLog1 = (x)=> {Console.WriteLine($"-----{x}-----");};
    ShowLog showLog2 = Warning;
    ShowLog showLog3 = Info;

    var all = showLog1 + showLog2 + showLog3 + showLog1;

    all("Xin Chào");
}
```

## 4.3 Func và Action
`Func` và `Action` là hai mẫu delegate định nghĩa sẵn, giúp bạn nhanh chóng tạo ra biến kiểu delegate mà không mất công khai báo, xem lại ví dụ trên nếu sử dụng đến `Func`, `Action` thì không cần có dòng khai báo:
### Sử dụng Func
**Func** là mẫu `delegate` có kiểu trả về. Để khai báo biến delegate dùng cú pháp như sau:
Func<kiểu_tham_số_1, kiểu_tham_số_2, ..., kiểu_trả_về> var_delegate;

```CSharp
Func<int, string, bool> function1;

// Khai báo delegate ở lớp
delegate bool DelegateName(int a, string b);
// Khai báo biến trong phương thức
DelegateName bien1;
```

### Sử dụng Action
`Action` tương tự như `Func`, điều khác duy nhất là nó không có kiểu trả về, khai báo cơ bản như sau:
Action<kiểu_tham_số_1, kiểu_tham_số_2, ... > var_delegate;
```CSharp
public static void TestAction(string s)
{
    Action<string> showLog = null;

    showLog += Logs.Warning;         // Nối thêm Warning vào delegate
    showLog += Logs.Info;            // Nối thêm Info vào delegate
    showLog += Logs.Warning;         // Nối thêm Warning vào delegate

    // Một lần gọi thi hành tất cả các phương thức trong chuỗi delegate
    showLog("TestLog");
}
```

## 4.4 Sử dụng Delegate làm tham số hàm
Có thể sử dụng delegate làm tham số của phương thức, nó có vai trò như những hàm callback linh hoạt. Xem ví dụ sau:
```CSharp
// Sử dụng Delegate làm tham số phương thức, truyền callback
static void TinhTong(int a, int b, Action callback)
{
    int c = a + b;
    // Gọi callback
    callback(c.ToString());
}

public static void TestTinhTong()
{
    TinhTong(5,6, (x) => Console.WriteLine($"Tổng hai số là: {x}"));
    TinhTong(1,3, Logs.Info);
}
```

## 4.5 Example
```CSharp
using System;
namespace CS_Delegate
{
    public delegate void ShowLog(string message);

    class Program
    {
        static void Info(string s)
        {
            Console.ForegroundColor = ConsoleColor.Green;
            Console.WriteLine(s);
            Console.ResetColor();
        }
        static void Main(string[] args)
        {
            ShowLog log = null;
            log = Info;
            log("Call basic");
            log?.Invoke("Call by Invoke");
			// Tạo danh sách các delegate invocation list 
			var invocationList = log.GetInvocationList();
			
            Console.ReadKey();
        }
    }

}
```